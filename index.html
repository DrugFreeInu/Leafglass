<!DOCTYPE html>
<html>
<head>
  <title>leafglass</title>

  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />

  <style>
    body {
      background: #ffffff;
      text-align: center;
    }

    .leafpic {
      width: 400px;
      border: 4px solid black;
      margin: 40px auto;
      display: block;
    }

    #keyed {
      border: 4px solid black;
      margin: 40px auto;
      display: block;
    }
  </style>
</head>
<body>

  <img class="leafpic" src="9C0FB4CC-FA9E-4434-BAB2-C7F2F55F9464.png">

  <canvas id="keyed"></canvas>

  <script>
    function rgbToHue(r, g, b) {
      r /= 255; g /= 255; b /= 255;

      const max = Math.max(r, g, b),
            min = Math.min(r, g, b);
      let h;

      if (max === min) {
        h = 0;
      } else if (max === r) {
        h = ((g - b) / (max - min)) % 6;
      } else if (max === g) {
        h = (b - r) / (max - min) + 2;
      } else {
        h = (r - g) / (max - min) + 4;
      }

      h = Math.round(h * 60);
      if (h < 0) h += 360;
      return h;
    }

    const img = new Image();
    img.src = "4FB1A1AB-8FE2-4160-9EC8-2D7867D028B3.png";

    img.onload = () => {
      const canvas = document.getElementById("keyed");
      canvas.width = img.width;
      canvas.height = img.height;
      const ctx = canvas.getContext("2d");

      ctx.drawImage(img, 0, 0);

      let imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
      let data = imageData.data;

      for (let i = 0; i < data.length; i += 4) {
        let r = data[i];
        let g = data[i + 1];
        let b = data[i + 2];

        // hue
        let hue = rgbToHue(r, g, b);

        // saturation
        let max = Math.max(r, g, b);
        let min = Math.min(r, g, b);
        let sat = max === 0 ? 0 : (max - min) / max;

        // remove ONLY fully saturated neon-green background
        if (hue >= 85 && hue <= 115 && sat > 0.45) {
          data[i + 3] = 0;
        }
      }

      ctx.putImageData(imageData, 0, 0);
    };
  </script>

</body>
</html>
